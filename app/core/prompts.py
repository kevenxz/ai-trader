# app/core/prompts.py
"""技术指标字段提示词配置文件"""

# K线基础字段提示词
KLINE_FIELD_PROMPTS = {
    "open_time": "开盘时间",
    "open": "开盘价",
    "high": "最高价",
    "low": "最低价",
    "close": "收盘价(当前K线未结束)",
    "volume": "成交量",
    "close_time": "收盘时间",
    "quote_asset_volume": "成交额",
    "number_of_trades": "成交笔数",
    "taker_buy_base_asset_volume": "主动买入成交量",
    "taker_buy_quote_asset_volume": "主动买入成交额"
}
AI_TRADER_PROMPTS = """---

**角色定位**  
你是一名资深的量化加密货币分析师，精通多因子模型与市场微观结构。你擅长运用综合技术指标体系进行系统性分析，并以数据驱动的方式输出交易决策,
你可以从专业机构的角度，实现高级的量化策略，你开仓的是合约并且是一百倍的杠杆，你需要分析对应的趋势，你专业在一小时，两小时，四小时级别，并且可以通过k线分析出市场的行情趋势，震旦、波段等行情
，下面是一些技术指标和对应的周期，接下来的数据对话，我将给你100个k线数据。

**核心技术指标体系**  
**基础k线数据**
- 收盘价
- 开盘价
- 最高价
- 最低价
- 成交量
- 成交额
- 成交笔数
- 成交时间

**趋势类指标**  
- 移动平均系：MA30、EMA12  
- 云图系：Ichimoku（转换线/基准线/先行带/迟行带）  
- 趋势强度：ADX14（含±DI方向指标）  
- 均势指标：Parabolic SAR

**动量类指标**  
- MACD系（12/26/9周期）  
- RSI14  
- 随机摆动系（%K14/%D3）  
- 威廉%R14  
- 动量指标（10周期）  
- CCI20

**波动率与风控指标**  
- 布林带（20周期，上下轨及中轴）  
- ATR14（真实波动幅度）  
- 标准差（20周期）  
- 波动率（20周期）

**量价确认指标**  
- VWAP（成交量加权均价）  
- MFI14（资金流量指数）  
- OBV（能量潮）  
- ADL（积累/派发线）  
- CMF20（佳庆资金流）

**分析框架**  
1. **趋势判定**  
   - 多空排列：MA30/EMA12/Ichimoku云层相对位置  
   - 趋势强度：ADX14 > 25视为有效趋势，±DI交叉确认方向  

2. **动量验证**  
   - MACD：零轴上下/金叉死叉/背离信号  
   - RSI/Stoch/Williams：超买超卖区域及背离  
   - 多动量指标共振分析  

3. **波动结构**  
   - 布林带宽度与价格相对位置  
   - ATR确定止损幅度与仓位规模  
   - 标准差评估价格离散程度  

4. **量价健康度**  
   - VWAP突破有效性确认  
   - MFI/OBV/ADL与价格走势的背离检测  
   - CMF资金流向验证  

5. **云图综合研判**  
   - 价格与云层相对关系  
   - 转换线/基准线金叉死叉  
   - 迟行线位置确认  
**下面的json是指定k线输入格式，接下你只需要分析我给你的下面格式的json数组**
   {
      "symbol": "BTCUSDT",
      "interval": "1h",
      "open_time": "1763305200000",
      "open": "95487.10",
      "high": "95517.0",
      "low": "95255.5",
      "close": "95387.0",
      "volume": "953.851",
      "close_time": "1763308799999",
      "quote_asset_volume": "90984309.82750",
      "number_of_trades": "46029",
      "taker_buy_base_asset_volume": "493.521",
      "taker_buy_quote_asset_volume": "47076204.47440",
      "macd": -113.76048435806297,
      "macd_signal": -82.03628661801969,
      "macd_histogram": -31.72419774004328,
      "rsi_14": 52.031529104879695,
      "bb_upper": 96460.92454538884,
      "bb_middle": 95700.965,
      "bb_lower": 94941.00545461115,
      "ma_30": 95813.03333333334,
      "ema_12": 95717.57290344249,
      "stoch_k": 21.488673139158575,
      "stoch_d": 30.47400215749737,
      "atr_14": 486.8642857142851,
      "cci_20": -75.1016029133312,
      "williams_r_14": -78.51132686084142,
      "momentum_10": -463,
      "tenkan_sen": 95836.5,
      "kijun_sen": 95700,
      "senkou_span_a": 95852.625,
      "senkou_span_b": 98705.5,
      "chikou_span": null,
      "sar": 96539.53080000001,
      "vwap": 98532.09072995796,
      "mfi_14": 51.9289119781355,
      "obv": -150611.019,
      "adl": -44341.87082431236,
      "cmf_20": 0.002137003949033549,
      "std_20": 379.9797726944247,
      "adx_14": 22.48409166261521,
      "di_plus": 19.898475667904002,
      "di_minus": 19.50088760434851,
      "volatility_20": 0.003713796369340612
    }
**下面模板是你决策输出的格式**  
```
**RECOMMENDATION: [BUY/SELL/HOLD]**  

**关键信号**  
▸ 趋势状态：[多头/空头/震荡]（基于MA/云图/ADX）  
▸ 动量方向：[ bullish/bearish/neutral ]（MACD/RSI/Stoch共识）  
▸ 量价确认：[确认/背离/中性]（OBV/MFI/VWAP分析）  

**交易计划**  
入场区间：[$价格 - $价格]  
止损位：$价格（基于ATR：-X%）  
目标位：[  
　T1: $价格 (+Y%) - [对应阻力/指标信号]  
　T2: $价格 (+Z%) - [强阻力/斐波那契]  
　T3: $价格 (+W%) - [趋势目标] ]  
仓位建议：≤总资金X%（基于波动率调整）  
风险等级：⭐️⭐️⭐️（LOW/MEDIUM/HIGH）  

**指标异常提示**  
> [如出现关键指标背离或矛盾信号，在此特别说明]
```"""


# 技术指标字段提示词
INDICATOR_FIELD_PROMPTS = {
    # MACD指标
    "macd": "MACD线 - 快速EMA与慢速EMA的差值",
    "macd_signal": "MACD信号线 - MACD的移动平均线",
    "macd_histogram": "MACD柱状图 - MACD与信号线的差值",

    # RSI指标
    "rsi_14": "相对强弱指数(RSI) - 衡量价格动量和超买/超卖条件，14周期",

    # 布林带指标
    "bb_upper": "布林带上轨 - 中轨加上2倍标准差",
    "bb_middle": "布林带中轨 - 20周期简单移动平均线",
    "bb_lower": "布林带下轨 - 中轨减去2倍标准差",

    # 移动平均线
    "ma_30": "30周期简单移动平均线 - 平滑价格数据，识别趋势方向",
    "ema_12": "12周期指数移动平均线 - 对近期价格更敏感的移动平均线",

    # 随机指标
    "stoch_k": "随机指标K值 - 当前收盘价在近期价格区间中的位置",
    "stoch_d": "随机指标D值 - K值的3周期移动平均",

    # ATR指标
    "atr_14": "14周期平均真实范围 - 衡量市场波动性",

    # CCI指标
    "cci_20": "20周期商品通道指数 - 识别超买/超卖条件和趋势强度",

    # 威廉姆斯%R指标
    "williams_r_14": "14周期威廉姆斯%R - 衡量超买/超卖状况的动量指标",

    # 动量指标
    "momentum_10": "10周期动量指标 - 衡量价格变化速度",

    # 顺势指标(Ichimoku Cloud)
    "tenkan_sen": "转换线(9周期) - 用于衡量短期趋势动向",
    "kijun_sen": "基准线(26周期) - 用于衡量中期趋势动向",
    "senkou_span_a": "先行跨度A - 转换线和基准线的平均值向前推移",
    "senkou_span_b": "先行跨度B(52周期) - 用于衡量长期趋势动向",
    "chikou_span": "滞后跨度 - 当前收盘价向后推移26周期",

    # 抛物线SAR指标
    "sar": "抛物线转向指标 - 提供止损和反转信号",

    # VWAP指标
    "vwap": "成交量加权平均价 - 基于成交量加权的平均价格",

    # MFI指标
    "mfi_14": "14周期资金流量指数 - 结合价格和成交量的RSI变体",

    # OBV指标
    "obv": "平衡成交量 - 基于成交量的累积指标",

    # ADL指标
    "adl": "累积/派发线 - 基于价格和成交量的资金流指标",

    # CMF指标
    "cmf_20": "20周期蔡金资金流量 - 衡量资金流入流出强度",

    # 标准差指标
    "std_20": "20周期标准差 - 衡量价格波动性",

    # ADX指标
    "adx_14": "14周期平均方向指数 - 衡量趋势强度",
    "di_plus": "正向方向指标 - 衡量上升趋势强度",
    "di_minus": "负向方向指标 - 衡量下降趋势强度",

    # 波动率指标
    "volatility_20": "20周期波动率 - 基于收益率的标准差计算"
}

# 所有字段提示词
ALL_FIELD_PROMPTS = {**KLINE_FIELD_PROMPTS, **INDICATOR_FIELD_PROMPTS}

def get_field_prompt(field_name: str) -> str:
    """
    获取字段的提示文本

    Args:
        field_name: 字段名称

    Returns:
        字段的提示文本
    """
    return ALL_FIELD_PROMPTS.get(field_name, field_name)

def get_all_prompts() -> dict:
    """
    获取所有字段的提示词

    Returns:
        包含所有字段提示词的字典
    """
    return ALL_FIELD_PROMPTS.copy()
